# 🚁 Heliworld - Multiplayer Synchronization

## 📡 네트워크 구조

- **통신 방식:** TCP 소켓 통신 기반
- **주기:** 서버는 20ms마다 상태 패킷 전송 (≈60Hz), 클라이언트는 키 입력 변경 시 + 33ms 주기로 입력 전송

## 🔁 동기화 방식

### 1. 위치 및 회전
- 서버는 authoritative 방식으로 각 클라이언트의 키 입력 정보를 받아 플레이어의 위치를 계산합니다.
- 클라이언트는 입력 기반으로 예측 이동을 수행한 뒤, 서버로부터 받은 값과 보간하여 렌더링합니다.
- 회전은 클라이언트 입력을 그대로 반영하여, 자연스러운 조작감을 유지했습니다.

### 2. 지연 보간
- 클라이언트는 RTT(Round Trip Time) 평균을 기반으로 서버의 과거 상태를 추정합니다.
- 보간 시점 계산:  
  `서버 추정 시각 = 클라이언트 타임스탬프 + 서버-클라이언트 평균 오프셋 - delay`
- delay는 평균 RTT의 절반에 여윳값(80ms)를 더해 계산하며, 네트워크 지연 시에도 안정적인 보간을 수행합니다.

### 3. 클라이언트 예측
- 이동, 회전 입력은 즉시 반영하여 조작감을 유지합니다.

### 4. 입력 재적용
- 클라이언트는 프레임별 입력과 결과값을 저장합니다.
- 서버 결과와 클라이언트 예측값 사이에 일정 오차 이상 발생 시, 서버 위치로 리셋하고 입력을 순서대로 재적용합니다.

## 🚀 미사일 동기화

### 1. 클라이언트 예측
- 미사일 발사 입력 시 클라이언트에서 임의로 미사일을 발사하여 위치를 예측합니다.
- 발사한 미사일 번호를 입력 정보에 포함시켜 전송하며, 서버는 이를 기반으로 위치를 계산할 수 있도록 합니다. 

## 📦 기술 스택

- TCP 소켓 통신 (멀티스레딩, concurrency-safe 큐 활용)
- C++
- DirectX 12

## 🧪 테스트 환경

- 본 프로젝트의 네트워크 동기화 시스템은 실제 지연 환경을 고려하여 설계되었습니다.
- [**Clumsy**](https://jagt.github.io/clumsy/)를 사용해 인위적인 네트워크 지연을 적용한 상태에서 시스템을 검증하였습니다.
- 테스트 조건 예시:
  - 지연 (Latency): 50ms ~ 100ms
- 해당 환경에서 각 플레이어와 미사일의 위치 및 회전 동기화가 잘 이루어지고 있음을 확인하였습니다.

## 🛠️ 개선 사항 / 회고

- [ ] **플레이어 위치 오차 개선**  
  현재 네트워크 지연이 심해질 수록 위치 오차가 점차 누적되어 스냅 + 입력 재적용이 자주 발생 = 끊김 현상

- [ ] **미사일 위치 오차 개선**      
  위 플레이어 위치 오차로 인해 미사일 발사 위치가 달라, 로컬 플레이어의 미사일이 흔들려 보이는 문제 발생

  ->클라이언트 발사 시점의 위치를 서버에서 수신해 사용하는 방식 도입 검토 중

## 🎥 시연 영상
